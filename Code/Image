import matplotlib.pyplot as plt

fichier = open("csv_serveur.csv")

def get_derniere_heure(fichier):
  """
  Renvoie un tableau de tableaux les sous-tableaux les lignes de fichier passé en argument. Cela prend la derniere heure.
  """
  tableau = fichier.readlines()[-31:-1]
  fichier.seek(0, 0)
  nouveau_tableau = []
  for i in range(len(tableau)):
    ligne = tableau[i][:-3].split(",")
    nouveau_tableau.append(ligne)
  #Securité
  while len(nouveau_tableau) < 30:
    nouveau_tableau.append("Fausse ligne")
  return nouveau_tableau

def get_ordonnee(num_colonne):
    ordonnees = []
    tableau = get_derniere_heure(fichier)
    for ligne in range(30):
      valeur = tableau[ligne][num_colonne]
      #Remplace les virgules par des points pour pouvoir les convertir en float
      valeur = valeur.replace(",", ".")
      valeur = float(valeur)
      ordonnees.append(valeur)
    return ordonnees

def get_image(num_colonne, titre, mini, maxi):
    abscisse = [i for i in range(-60, 0, 2)]
    ordonnees = get_ordonnee(num_colonne)
    plt.plot(abscisse, ordonnees)
    plt.title(titre)
    decalage = (maxi - mini) / 3
    plt.axhspan(mini, mini + decalage, facecolor="r", alpha=0.5)
    plt.axhspan(mini + decalage, mini + decalage * 2, facecolor="y", alpha=0.5)
    plt.axhspan(mini + decalage * 2, maxi, facecolor="g", alpha=0.5)
    nom_fichier = titre + ".png"
    plt.savefig(nom_fichier)
    plt.cla()

get_image(6, "Temperature", -10, 30)
get_image(8, "Vent", 0, 5)
get_image(3, "Nuage", -17, -12)
get_image(5, "Pluie", 0, 2688)

fichier.close()

